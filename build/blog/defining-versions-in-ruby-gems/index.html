<!doctype html>
<html>
  <head>
    <meta content='IE=edge' http-equiv='X-UA-Compatible'>
    <meta charset='utf-8'>
    <meta content='width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no' name='viewport'>
    <meta name='description' content="This post is inspired by a question I answered on StackOverflow a while back, asking about the best way to define the version of a Ruby gem.">
    

    <title>Defining versions in Ruby gems - Alex Peattie</title>

    <link href='//fonts.googleapis.com/css?family=Lato:300,400' rel='stylesheet' type='text/css'>

    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32-18545059.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192-62275dc0.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16-13aa2390.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab-b8c45f01.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ff0000">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ff0000">

    <link href="/assets/css/all-a7a0038a.css" rel="stylesheet" />
    <script src="/assets/js/all-a1da6af5.js"></script>
  </head>

  <body class='blog blog_defining-versions-in-ruby-gems blog_defining-versions-in-ruby-gems_index'>
    <header>
  <nav class='MainMenu'>
    <a href='/' class='Logo'>
      <span>emil</span>karlsson
    </a>

    <a class='NavBtn NavBtn--mobileOnly' data-toggle-modal-menu>Menu</a>

    <section class='MainMenu-links'>
      <a href='/' class='NavBtn' id='NavBtnAbout'>About Me</a>
      <a href='/projects' class='NavBtn' id='NavBtnProjects'>Projects</a>
    <!-- <a href='/talks' class='NavBtn' id='NavBtnTalks'>Talks</a> -->
    <!-- <a href='/blog' class='NavBtn' id='NavBtnBlog'>Blog</a> -->

      <a class='NavBtn NavBtn--close' data-toggle-modal-menu>✕</a>
    </nav>
  </nav>

  
</header>


    <main>
        <article class='ContentBody'>
    <h1>Defining versions in Ruby gems</h1>
    <h2 class='PostMeta'>
      <time datetime="2012-02-04" pubdate="true">4th February 2012</time> – 
      <a href='#comments' data-disqus-url='http://alexpeattie.com/blog/defining-versions-in-ruby-gems/'>comments</a>
    </h2>
    <p>This post is inspired by a <a href="http://stackoverflow.com/questions/7851498/defining-gem-version-in-gemspec/7852090#7852090">question I answered</a> on StackOverflow a while back, asking about the best way to define the version of a Ruby gem.</p>

<p>By far the simplest method is to just hardcode the version number in your <code>.gemspec</code>:</p>

<div class="codehilite ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="c1"># mygem.gemspec</span>
<span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">name</span>        <span class="o">=</span> <span class="s2">"mygem"</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">version</span>     <span class="o">=</span> <span class="s2">"1.0.0"</span>
<span class="k">end</span>
</pre></td></tr></tbody></table>
</div>

<p>But you'll often see gems instead defining the version in a separate file, then <code>require</code>'ing it in the <code>.gemspec</code>:</p>

<div class="codehilite ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre><span class="c1"># lib/mygem/version.rb</span>
<span class="k">module</span> <span class="nn">Mygem</span>
  <span class="no">VERSION</span> <span class="o">=</span> <span class="s2">"1.0.0"</span>
<span class="k">end</span>

<span class="c1"># mygem.gemspec</span>
<span class="vg">$:</span><span class="p">.</span><span class="nf">push</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s2">"../lib"</span><span class="p">,</span> <span class="kp">__FILE__</span><span class="p">)</span>
<span class="nb">require</span> <span class="s2">"mygem/version"</span>

<span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">name</span>        <span class="o">=</span> <span class="s2">"mygem"</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">version</span>     <span class="o">=</span> <span class="no">Mygem</span><span class="o">::</span><span class="no">VERSION</span>
<span class="k">end</span>
</pre></td></tr></tbody></table>
</div>

<p>More code for the apparently same effect, so what are the advantages of the more verbose method? Well, for one, we can easily access the gem's version easily with the <code>Mygem::VERSION</code>. This can come in handy for 3rd party apps - for instance, this Devise patch which targets specific versions (<a href="https://gist.github.com/parndt/4660837">source</a>):</p>

<div class="codehilite ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre><span class="c1"># config/initializers/devise_patch.rb</span>
<span class="nb">require</span> <span class="s1">'devise/version'</span>
<span class="k">if</span> <span class="o">!</span><span class="n">defined?</span><span class="p">(</span><span class="no">Devise</span><span class="o">::</span><span class="no">VERSION</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="no">Devise</span><span class="o">::</span><span class="no">VERSION</span> <span class="o">&lt;</span> <span class="s2">"1.4.0"</span> <span class="o">&amp;&amp;</span> <span class="sx">%w[1.2 1.3]</span><span class="p">.</span><span class="nf">all?</span> <span class="p">{</span><span class="o">|</span><span class="n">v</span><span class="o">|</span> <span class="o">!</span><span class="no">Devise</span><span class="o">::</span><span class="no">VERSION</span><span class="p">.</span><span class="nf">start_with?</span><span class="p">(</span><span class="n">v</span><span class="p">)})</span>
  <span class="k">raise</span> <span class="s2">"I don't know how to patch your devise version. See http://blog.plataformatec.com.br/2013/01/security-announcement-devise-v2-2-3-v2-1-3-v2-0-5-and-v1-5-3-released/"</span>
<span class="k">end</span>

<span class="k">if</span> <span class="no">Devise</span><span class="o">::</span><span class="no">VERSION</span> <span class="o">&lt;</span> <span class="s2">"1.5.0"</span>
  <span class="nb">warn</span> <span class="s2">"Patching devise </span><span class="si">#{</span><span class="no">Devise</span><span class="o">::</span><span class="no">VERSION</span><span class="si">}</span><span class="s2"> with &lt; 1.5.0 patch"</span>
  <span class="no">Devise</span><span class="o">::</span><span class="no">Models</span><span class="o">::</span><span class="no">Authenticatable</span><span class="o">::</span><span class="no">ClassMethods</span><span class="p">.</span><span class="nf">class_eval</span> <span class="k">do</span>
    <span class="k">def</span> <span class="nf">auth_param_requires_string_conversion?</span><span class="p">(</span><span class="n">value</span><span class="p">);</span> <span class="kp">true</span><span class="p">;</span> <span class="k">end</span>
  <span class="k">end</span>
<span class="k">elsif</span> <span class="p">[(</span><span class="s2">"1.5.0"</span><span class="p">.</span><span class="nf">.</span><span class="s2">"1.5.3"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"2.0.0"</span><span class="p">.</span><span class="nf">.</span><span class="s2">"2.0.4"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"2.1.0"</span><span class="p">.</span><span class="nf">.</span><span class="s2">"2.1.2"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"2.2.0"</span><span class="p">.</span><span class="nf">.</span><span class="s2">"2.2.2"</span><span class="p">)].</span><span class="nf">any?</span> <span class="p">{</span> <span class="o">|</span><span class="n">range</span><span class="o">|</span>
  <span class="n">range</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="no">Devise</span><span class="o">::</span><span class="no">VERSION</span><span class="p">)</span>
<span class="p">}</span>
  <span class="nb">warn</span> <span class="s2">"Patching devise </span><span class="si">#{</span><span class="no">Devise</span><span class="o">::</span><span class="no">VERSION</span><span class="si">}</span><span class="s2"> with &lt; 2.2.3 patch"</span>
  <span class="no">Devise</span><span class="o">::</span><span class="no">ParamFilter</span><span class="p">.</span><span class="nf">class_eval</span> <span class="k">do</span>
    <span class="k">def</span> <span class="nf">param_requires_string_conversion?</span><span class="p">(</span><span class="n">_value</span><span class="p">);</span> <span class="kp">true</span><span class="p">;</span> <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table>
</div>

<p>Also if we wanted to see Git commits that changed the gem's version, we could run:</p>

<div class="codehilite plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>git log version.rb
</pre></td></tr></tbody></table>
</div>

<p>A couple of further tips - it's not a bad idea to use <code>.freeze</code> to stop <code>Mygem::VERSION</code> getting overwritten accidentally:</p>

<div class="codehilite ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="k">module</span> <span class="nn">Mygem</span>
  <span class="no">VERSION</span> <span class="o">=</span> <span class="s2">"1.0.0"</span><span class="p">.</span><span class="nf">freeze</span>
<span class="k">end</span>
</pre></td></tr></tbody></table>
</div>

<p>Some gems (including <a href="https://github.com/rails/rails/blob/master/version.rb">Rails</a>) break down the version number into <code>MAJOR</code>, <code>MINOR</code> and <code>TINY</code> (or <code>PATCH</code>) releases:</p>

<div class="codehilite ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="k">module</span> <span class="nn">Mygem</span>
  <span class="k">module</span> <span class="nn">VERSION</span>
    <span class="no">MAJOR</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="no">MINOR</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="no">TINY</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="no">STRING</span> <span class="o">=</span> <span class="p">[</span><span class="no">MAJOR</span><span class="p">,</span> <span class="no">MINOR</span><span class="p">,</span> <span class="no">TINY</span><span class="p">].</span><span class="nf">compact</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table>
</div>

<p>This is handy if you're following <a href="http://semver.org/">semantic versioning</a>.</p>

  </article>
  
  <article class='Comments'>
  <h2 id='comments'>Comments</h2>

  <div id='disqus_thread'>
  </div>

  <script>
    var disqus_shortname = 'alexpeattie';
    var disqus_url = 'http://alexpeattie.com/blog/defining-versions-in-ruby-gems/';
    var disqus_identifier = '2012 02 04 defining versions in ruby gems';

    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
      var s = document.createElement('script'); s.async = true; s.type = 'text/javascript';
      s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq).appendChild(s);
    })();
  </script>
</article>

    </main>

    <section class='SourceCallout'>
    <!--  <p>This site is open-source (<a href='/projects#site'>more info</a>) - here's <a href="https://github.com/alexpeattie/alexpeattie.com/blob/master/source/blog/2012-02-04-defining-versions-in-ruby-gems.html.md">the source code for this page</a></a>.</p>-->
    </section>

    <footer>
      <p>© 2018 Emil Karlsson. Questions? Email <a href='mailto:me@emilingemarkarlsson@gmail.com'>emilingemarkarlsson@gmail.com</a>
      </p>
    </footer>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-116235734-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>
